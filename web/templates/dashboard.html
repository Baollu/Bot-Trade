<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Trade - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-weight: 600;
            color: #666;
        }

        .metric-value {
            font-size: 1.3em;
            font-weight: bold;
        }

        .price {
            font-size: 3em;
            color: #667eea;
            text-align: center;
            margin: 20px 0;
        }

        .prediction {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .prediction.UP {
            background: #d4edda;
            color: #155724;
        }

        .prediction.DOWN {
            background: #f8d7da;
            color: #721c24;
        }

        .prediction.NEUTRAL {
            background: #fff3cd;
            color: #856404;
        }

        .prediction-class {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .prediction-confidence {
            font-size: 1.2em;
        }

        .trade-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .trade-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .trade-item.BUY {
            border-left-color: #28a745;
        }

        .trade-item.SELL {
            border-left-color: #dc3545;
        }

        .trade-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .trade-type {
            font-weight: bold;
            padding: 3px 10px;
            border-radius: 5px;
            color: white;
        }

        .trade-type.BUY {
            background: #28a745;
        }

        .trade-type.SELL {
            background: #dc3545;
        }

        .blockchain-link {
            color: #667eea;
            text-decoration: none;
            font-size: 0.9em;
        }

        .blockchain-link:hover {
            text-decoration: underline;
        }

        .positive {
            color: #28a745;
        }

        .negative {
            color: #dc3545;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .auto-refresh {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            color: #666;
            font-size: 0.9em;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .live-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #28a745;
            border-radius: 50%;
            margin-right: 5px;
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ü§ñ Nexus Trade</h1>
            <p class="subtitle">Syst√®me de Trading Autonome propuls√© par IA & Blockchain</p>
            <div class="auto-refresh">
                <span class="live-indicator"></span>
                <strong>LIVE</strong> - Actualisation automatique toutes les 5 secondes
            </div>
        </header>

        <div class="grid">
            <!-- Prix Bitcoin -->
            <div class="card">
                <h2>üí∞ Prix Bitcoin</h2>
                <div class="price" id="current-price">
                    {{if .CurrentPrice}}
                        ${{printf "%.2f" .CurrentPrice}}
                    {{else}}
                        En attente...
                    {{end}}
                </div>
                <div class="metric">
                    <span class="metric-label">Derni√®re mise √† jour</span>
                    <span class="metric-value" id="price-timestamp">{{.Timestamp.Format "15:04:05"}}</span>
                </div>
            </div>

            <!-- Pr√©diction IA -->
            <div class="card">
                <h2>ü§ñ Pr√©diction IA</h2>
                {{if .LastPrediction}}
                <div class="prediction {{.LastPrediction.Class}}" id="prediction">
                    <div class="prediction-class">
                        {{if eq .LastPrediction.Class "UP"}}üìà HAUSSE{{else if eq .LastPrediction.Class "DOWN"}}üìâ BAISSE{{else}}‚ûñ NEUTRE{{end}}
                    </div>
                    <div class="prediction-confidence">
                        Confiance: {{printf "%.1f" (mul .LastPrediction.Confidence 100)}}%
                    </div>
                    <div style="margin-top: 10px; font-size: 0.9em;">
                        {{.LastPrediction.Timestamp.Format "15:04:05"}}
                    </div>
                </div>
                {{else}}
                <div class="prediction NEUTRAL">
                    <div class="prediction-class">En attente de donn√©es...</div>
                </div>
                {{end}}
            </div>

            <!-- Portefeuille -->
            <div class="card">
                <h2>üíº Portefeuille</h2>
                <div class="metric">
                    <span class="metric-label">Valeur totale</span>
                    <span class="metric-value">${{printf "%.2f" .PortfolioValue}}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">USD</span>
                    <span class="metric-value">${{printf "%.2f" .Portfolio.Balance}}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">BTC</span>
                    <span class="metric-value">{{printf "%.6f" .Portfolio.BTCHolding}}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Performance</span>
                    <span class="metric-value {{if ge .Performance 0}}positive{{else}}negative{{end}}">
                        {{if ge .Performance 0}}+{{end}}{{printf "%.2f" .Performance}}%
                    </span>
                </div>
            </div>

            <!-- Statistiques -->
            <div class="card">
                <h2>üìä Statistiques</h2>
                {{if .Stats}}
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value">{{.Stats.TotalTrades}}</div>
                        <div class="stat-label">Trades</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value {{if ge .Stats.TotalProfit 0}}positive{{else}}negative{{end}}">
                            {{if ge .Stats.TotalProfit 0}}+{{end}}${{printf "%.0f" .Stats.TotalProfit}}
                        </div>
                        <div class="stat-label">Profit Total</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">{{printf "%.1f" .Stats.WinRate}}%</div>
                        <div class="stat-label">Taux de R√©ussite</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value {{if ge .Stats.AvgProfitTrade 0}}positive{{else}}negative{{end}}">
                            {{if ge .Stats.AvgProfitTrade 0}}+{{end}}${{printf "%.2f" .Stats.AvgProfitTrade}}
                        </div>
                        <div class="stat-label">Profit Moyen</div>
                    </div>
                </div>
                {{end}}
            </div>
        </div>

        <!-- Liste des trades -->
        <div class="card">
            <h2>üìú Historique des Trades (Certifi√©s Blockchain)</h2>
            <div class="trade-list" id="trades-list">
                {{if .RecentTrades}}
                {{range .RecentTrades}}
                <div class="trade-item {{.Type}}">
                    <div class="trade-header">
                        <span class="trade-type {{.Type}}">{{.Type}}</span>
                        <span>{{.ExecutedAt.Format "02/01 15:04:05"}}</span>
                    </div>
                    <div class="metric">
                        <span>Prix</span>
                        <span>${{printf "%.2f" .Price}}</span>
                    </div>
                    <div class="metric">
                        <span>Quantit√©</span>
                        <span>{{printf "%.6f" .Quantity}} BTC</span>
                    </div>
                    {{if ne .Type "BUY"}}
                    <div class="metric">
                        <span>Profit</span>
                        <span class="{{if ge .Profit 0}}positive{{else}}negative{{end}}">
                            {{if ge .Profit 0}}+{{end}}${{printf "%.2f" .Profit}}
                        </span>
                    </div>
                    {{end}}
                    {{if .BlockchainHash}}
                    <div style="margin-top: 10px;">
                        <a href="https://sepolia.etherscan.io/tx/{{.BlockchainHash}}" 
                           target="_blank" 
                           class="blockchain-link">
                            ‚õìÔ∏è Voir sur Blockchain: {{slice .BlockchainHash 0 12}}...
                        </a>
                    </div>
                    {{end}}
                </div>
                {{end}}
                {{else}}
                <p style="text-align: center; color: #666; padding: 20px;">
                    Aucun trade effectu√© pour le moment
                </p>
                {{end}}
            </div>
        </div>
    </div>

    <script>
        // Auto-refresh toutes les 5 secondes
        setInterval(() => {
            fetch('/api/dashboard')
                .then(response => response.json())
                .then(data => {
                    // Mettre √† jour le prix
                    if (data.current_price) {
                        document.getElementById('current-price').textContent = 
                            '$' + data.current_price.toFixed(2);
                    }
                    
                    // Rafra√Æchir la page compl√®te toutes les 30 secondes pour √©viter la d√©synchronisation
                    if (Math.random() < 0.2) { // 20% de chance toutes les 5 sec = ~30 sec
                        location.reload();
                    }
                })
                .catch(err => console.error('Erreur refresh:', err));
        }, 5000);
    </script>
</body>
</html>
